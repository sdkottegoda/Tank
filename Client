using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Net.Sockets;
using System.IO;
using System.Net;

namespace Shooter
{
    class Client
    {
        System.Net.Sockets.TcpClient clientSocket;
        private NetworkStream clientStream; //Stream - outgoing
        private TcpClient client; //To talk back to the client
        private BinaryWriter writer; //To write to the clients

        private NetworkStream serverStream; //Stream - incoming        
        private TcpListener listener; //To listen to the clinets        
        public string reply = ""; //The message to be written

        public Client()
        {
            load();
        }
        private void load()
        {

            msg("Client Started");

            listener = new TcpListener(IPAddress.Parse("127.0.0.1"), 7000);
            listener.Start();
        }

        public void connect()
        {
            clientSocket.Connect("127.0.0.1", 6000);
            if (clientSocket.Connected)
            {
                Console.WriteLine("Client Socket Program - Server Connected ...");
            }
        }


        public String send(String message)
        {

            clientSocket = new System.Net.Sockets.TcpClient();
            connect();

            NetworkStream serverStream = clientSocket.GetStream();
            byte[] outStream = System.Text.Encoding.ASCII.GetBytes(message);
            serverStream.Write(outStream, 0, outStream.Length);
            clientSocket.Close();
            serverStream.Flush();

            Socket connection = listener.AcceptSocket();

            if (connection.Connected)
            {
                Console.WriteLine("recieving data from server");
            }
            this.serverStream = new NetworkStream(connection);

            SocketAddress sockAdd = connection.RemoteEndPoint.Serialize();
            string s = connection.RemoteEndPoint.ToString();
            List<Byte> inputStr = new List<byte>();

            int asw = 0;
            while (asw != -1)
            {
                asw = this.serverStream.ReadByte();
                inputStr.Add((Byte)asw);
            }

            reply = Encoding.UTF8.GetString(inputStr.ToArray());
            this.serverStream.Close();


            return reply.Substring(0, reply.IndexOf("#"));

        }

        public void msg(string mesg)
        {
            Console.WriteLine(Environment.NewLine + " >> " + mesg);
        }




    }
}
